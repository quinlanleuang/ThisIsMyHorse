#索引（上）

- 索引的出现时为了提高数据的查询效率，就像书的目录一样

### 索引模型

- 哈希表，以key-value为存储的数据结构，冲突如何解决，只适用于等值查询的情况
- 有序数组，适用于等值查询和范围查询，只适用于数据不会再修改的静态存储引擎，因为每插入新的记录，都需要将部分数据向后移动
- 二叉搜索树，为了保持O(logN)的查询复杂度，需要保持这个树是平衡二叉树，为了做这个保证，更新的时间复杂度也是O(logN)
- 读磁盘是一个相当耗时的操作（10ms），为了提高数据的查询效率，应尽可能少的读磁盘。而读磁盘的次数由树的高度决定，树越高读磁盘的次数越多。因此，应尽可能的减小树的高度，在相同的节点数的情况下，N叉树比二叉树高读小很多
- 跳表，LSM树？

### InnoDB的索引模型

- 主键索引，叶子结点存的是整行数据。在InnoDB里，主键索引也称为聚簇索引

- 非主键索引，叶子结点存的是主键的值。在InnoDB里，非主键索引也被称为二级索引

- 基于主键索引和普通索引的查询有什么区别？

  ```
  1. 基于主键索引的查询，只需要搜索主键索引的B+树
  2. 基于普通索引的查询，需要现搜索普通所以的B+树，再到主键索引的B+树里搜索一次。这个过程称为回表
  ```

### 索引维护

- B+树是有序的，因此，在插入新数据时需要做必要的维护

- 插入时，需要逻辑上挪动后面的数据，腾出位置。特殊情况，如果数据页已经满了，此时插入新数据，会导致页分裂。即申请一个新的页，然后挪动部分数据到新的页中，页分裂会导致性能问题和空间利用率低到问题

- 使用自增ID做主键的优势

  ```
  1. 每次插入都是追加操作，不会挪动其他记录，也不会出现页分裂的情况
  2. 非主键索引（二级索引）占用的空间更小
  ```

- KV场景要求只有一个索引，该索引是唯一的，此时适合将业务字段作为主键
- 