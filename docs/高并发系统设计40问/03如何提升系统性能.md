### 高并发系统三大目标：高性能、高可用、可扩展
- 高并发，是指运用设计手段让系统能够处理更多的用户并发请求，承担更大的流量
- 性能，响应时间&吞吐量
- 可用性，系统可以正常提供服务的时间
- 流量分为平时流量和峰值流量
- 可扩展性好的系统能够迅速完成扩容，更加平稳的承担峰值流量

### 性能优化原则
- 性能优化一定不能盲目，一定是问题导向的，部分优化会损伤业务
- 性能优化也遵循二八原则，即可以用20%的精力解决80%的性能问题
- 性能优化要有数据支撑，在优化的过程中，你需要了解你的优化让响应时间减少了多少，吞吐量增加了多少
- 性能优化的过程是持续的

### 性能的度量指标
- 需要收集一段时间内接口的响应时间数据，然后根据一些统计方法计算出特征值，这些特征值就能够表示这段时间的性能情况
- 平均值，即平均每个接口的响应时长。它的敏感度比较差，如果这段时间有少量的慢请求，在平均值上并不能如实反映
- 最大值，即一段时间内接口响应时间的最大值，它的敏感度太高了
- 分位值，指一段时间内的接口响应时间按照从小到大排序。
  ![](https://static001.geekbang.org/resource/image/1e/1e/1eb73981dfb18cfde5088c96d0c5cf1e.jpg)
- 我们通常使用吞吐量和响应时间来度量并发和流量
- 设立性能优化目标时，我们通常这样描述：在每秒1w次的请求量下，响应时间99分位值在10ms以下
- 从用户体验的角度来看，200ms是第一个分界点，接口响应时间在200ms以内，用户是感觉不到延迟的。而1s是另一个分界点，接口响应时间在1s之内，虽然用户可以感受到一些延迟，但却是可以接受的。超过1s，用户就有明显的等待感觉，等待时间越长，用户体验越差。所以健康系统的标准是：99分位值的响应时间控制在200ms之内，不超过1s的请求占比要在99.99%之上

### 高并发下的性能优化
- 提高系统的处理核心数，增加系统进程，并绑定在不同的核心上。
- 我们在评估系统性能时，经常需要做压力测试，目的就是找到系统的“拐点”，从而知道系统的承载能力，便于找到系统的瓶颈，持续优化系统性能
  ![](https://static001.geekbang.org/resource/image/23/3f/2379fce36fa3453a0326e62e4d5a333f.jpg)
- 减少单次任务响应时间，需要判断系统是CPU密集型还是IO密集型
- 如果是CPU密集型，优化方式就是选用更加高效的算法或者减少运算次数，发现这类问题，需要通过Profile工具来定位消耗CPU时间最多的模块
- 如果是IO密集型，发现这类性能瓶颈的手段要么是通过监控来发现，要么是采用Linux的工具来发现

### 其他
- 数据优先，在做一个新的系统在上线之前，一定要把性能监控系统做好
- 掌握一些性能优化的工具和方法，这需要在工作中不断积累
- 计算机基础知识很重要，掌握了基础知识才能让你在优化的过程中抓住性能问题的关键，游刃有余    

### 一课一思
- 你在日常工作中有哪些性能优化的手段和经验呢？
  